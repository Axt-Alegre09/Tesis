<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Paniquiños — Admin</title>

  <!-- ⚠️ Seguridad en cliente (mejor servir como cabeceras de servidor) -->
  <meta http-equiv="Content-Security-Policy"
        content="
          default-src 'self';
          script-src 'self' https://cdn.jsdelivr.net https://esm.sh 'strict-dynamic';
          style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
          img-src 'self' https://jyygevitfnbwrvxrjexp.supabase.co data:;
          font-src 'self' https://cdn.jsdelivr.net data:;
          connect-src 'self' https://*.supabase.co wss://*.supabase.co;
          base-uri 'self';
          form-action 'self';
          frame-ancestors 'none';
          upgrade-insecure-requests;
          block-all-mixed-content;">
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="permissions-policy" content="geolocation=(), microphone=(), camera=()">

  <link rel="icon" href="https://jyygevitfnbwrvxrjexp.supabase.co/storage/v1/object/public/productos/paniquinosico.ico" type="image/x-icon">

  <!-- Bootstrap (SRI + crossorigin) -->
  <link
    rel="preconnect"
    href="https://cdn.jsdelivr.net" crossorigin>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-HTC3J3U2H2pR3M4m3D1j3kqC5m9H8z8+o7J2w+JtGxG5gk9m9E6j0e8Xr1y2e3K"
    crossorigin="anonymous">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet"
    integrity="sha384-v0d1l4bXJrX6y0gRrCw9A2W8i0y9r3n6z1gM6gZCqk4u7vJ0vQ0V7s2o8mH1v6Yr"
    crossorigin="anonymous">

  <!-- Tus estilos (asegura el case correcto de rutas) -->
  <link rel="stylesheet" href="CSS/main.css">
  <!-- Opcionales: crea archivos vacíos si aún no existen para evitar 404 -->
  <link rel="stylesheet" href="CSS/styleschat.css">
  <link rel="stylesheet" href="CSS/admin.css">
</head>
<body>
  <div class="wrapper has-topbar">
    <!-- ASIDE -->
    <aside id="mobileAside" aria-label="Menú lateral">
      <header class="aside-header editable-wrap">
        <h1 class="logo">
          <img id="logoPrincipal" class="logo-principal"
               src="https://jyygevitfnbwrvxrjexp.supabase.co/storage/v1/object/public/productos/paniquinos.png"
               alt="Paniquiños" referrerpolicy="no-referrer">
        </h1>
        <button class="mobile-close" id="menuClose" aria-label="Cerrar menú">
          <i class="bi bi-x-lg"></i>
        </button>

        <!-- Botón para cambiar logo (no inline handlers) -->
        <button class="edit-btn edit-logo" title="Cambiar logo" data-action="edit-logo">
          <i class="bi bi-pencil"></i>
        </button>
        <input id="fileLogo" type="file" accept="image/*" hidden>
      </header>

      <nav aria-label="Categorías">
        <ul class="menu" id="menuList">
          <li class="editable-wrap">
            <button id="todos" class="boton-menu boton-categoria active" type="button">
              <i class="bi bi-hand-index-fill"></i>
              <span data-editable>Categoría: Todos los productos</span>
            </button>
            <button class="edit-btn" title="Editar texto" data-target="[data-editable]" type="button">
              <i class="bi bi-pencil"></i>
            </button>
          </li>
          <li class="editable-wrap">
            <button id="bocaditos" class="boton-menu boton-categoria" type="button">
              <i class="bi bi-hand-index"></i>
              <span data-editable>Bocaditos</span>
            </button>
            <button class="edit-btn" title="Editar texto" data-target="[data-editable]" type="button">
              <i class="bi bi-pencil"></i>
            </button>
          </li>
          <li class="editable-wrap">
            <button id="confiteria" class="boton-menu boton-categoria" type="button">
              <i class="bi bi-hand-index"></i>
              <span data-editable>Confitería</span>
            </button>
            <button class="edit-btn" title="Editar texto" data-target="[data-editable]" type="button">
              <i class="bi bi-pencil"></i>
            </button>
          </li>
          <li class="editable-wrap">
            <button id="panificados" class="boton-menu boton-categoria" type="button">
              <i class="bi bi-hand-index"></i>
              <span data-editable>Panificados</span>
            </button>
            <button class="edit-btn" title="Editar texto" data-target="[data-editable]" type="button">
              <i class="bi bi-pencil"></i>
            </button>
          </li>
          <li class="editable-wrap">
            <button id="rosticeria" class="boton-menu boton-categoria" type="button">
              <i class="bi bi-hand-index"></i>
              <span data-editable>Rosticería</span>
            </button>
            <button class="edit-btn" title="Editar texto" data-target="[data-editable]" type="button">
              <i class="bi bi-pencil"></i>
            </button>
          </li>

          <li>
            <a class="boton-menu boton-carrito" href="carrito.html" rel="noopener">
              <i class="bi bi-cart-fill"></i>
              Carrito <span id="numerito" class="numerito">0</span>
            </a>
          </li>
        </ul>
      </nav>

      <footer class="editable-wrap">
        <p id="footerText" class="texto-footer" data-editable>© Paniquiños</p>
        <button class="edit-btn" title="Editar footer" data-target="[data-editable]" type="button">
          <i class="bi bi-pencil"></i>
        </button>
      </footer>
    </aside>

    <!-- TOPBAR -->
    <div class="site-topbar within">
      <div class="topbar-inner">
        <button class="mobile-toggle" id="menuToggle" aria-label="Abrir menú" aria-controls="mobileAside" aria-expanded="false" type="button">
          <i class="bi bi-list"></i>
        </button>

        <form class="searchbar" id="searchForm" role="search" novalidate>
          <i class="bi bi-search"></i>
          <input type="search" id="searchInput" placeholder="Buscar productos…" aria-label="Buscar productos" autocomplete="off">
          <button class="searchbar-btn" type="submit">Buscar</button>
        </form>

        <div class="user-menu">
          <button class="user-chip" id="userMenuBtn" aria-haspopup="true" aria-expanded="false" aria-controls="userDropdown" type="button">
            <i class="bi bi-person"></i>
            <span class="user-name" id="adminEmail">admin</span>
            <i class="bi bi-chevron-down chevron"></i>
          </button>

          <div class="user-dropdown user-dropdown--admin" id="userDropdown" role="menu">
            <!-- IMPORTANT: usamos data-route relativo y JS lo normaliza -->
            <button class="dropdown-item" data-route="catering.html" type="button"><i class="bi bi-calendar3"></i> Pedidos catering</button>
            <button class="dropdown-item" data-route="pendientes.html" type="button"><i class="bi bi-box-seam"></i> Pedidos Pendientes</button>
            <button class="dropdown-item" data-route="informeVentas.html" type="button"><i class="bi bi-graph-up"></i> Reporte de ventas</button>
            <button class="dropdown-item" data-route="reporteDia.html" type="button"><i class="bi bi-bar-chart"></i> Resumen del día</button>
            <button class="dropdown-item" data-route="topProductos.html" type="button"><i class="bi bi-trophy"></i> Productos más vendidos</button>
            <div class="dropdown-sep" role="separator"></div>
            <button class="dropdown-item" id="updateProfileBtn" type="button"><i class="bi bi-gear"></i> Editar usuario</button>
            <button class="dropdown-item danger" id="logoutBtn" type="button"><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</button>
          </div>
        </div>
      </div>
    </div>

    <main>
      <h2 id="titulo-principal" class="titulo-principal editable-wrap">
        <span data-editable>Pensado para vos</span>
        <button class="edit-btn edit-btn--inline" title="Editar título" data-target="[data-editable]" type="button"><i class="bi bi-pencil"></i></button>
      </h2>

      <div class="contenedor-productos" id="contenedor-productos"></div>
    </main>
  </div>

  <!-- Backdrop global -->
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

  <!-- Overlay logout -->
  <div id="logoutOverlay" hidden style="position:fixed;inset:0;background:rgba(255,255,255,.8);display:flex;align-items:center;justify-content:center;font-size:1.1rem;color:#333;z-index:9999">
    <div class="spinner-border me-2" role="status" aria-hidden="true"></div> Cerrando sesión…
  </div>

  <!-- Catálogo / login (tuyos) -->
  <script type="module" src="JS/loginAdmin.js"></script>
  <script type="module" src="JS/main.js"></script>

  <!-- Admin seguro (usa supa desde reports-core.js) -->
  <script type="module" src="JS/admin-index-secure.js"></script>
</body>
</html>
