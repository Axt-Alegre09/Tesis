<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catering - Paniquiños Admin</title>
  <link rel="shortcut icon" href="https://jyygevitfnbwrvxrjexp.supabase.co/storage/v1/object/public/productos/paniquinosico.ico" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="CSS/catering.css" />
  <script>
        (function() {
      // Función para aplicar tema
      function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
      }
      
      // Detectar tema del padre si estamos en un iframe
      function detectParentTheme() {
        try {
          if (window.parent && window.parent !== window) {
            const parentTheme = window.parent.document.documentElement.getAttribute('data-theme');
            if (parentTheme) {
              applyTheme(parentTheme);
              return true;
            }
          }
        } catch (e) {
          // Cross-origin, intentar con localStorage
        }
        
        // Fallback: usar localStorage
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          applyTheme(savedTheme);
          return true;
        }
        
        return false;
      }
      
      // Aplicar tema inmediatamente
      detectParentTheme();
      
      // Observar cambios en el padre
      function observeParentTheme() {
        try {
          if (window.parent && window.parent !== window) {
            const observer = new MutationObserver(function(mutations) {
              mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'data-theme') {
                  const newTheme = window.parent.document.documentElement.getAttribute('data-theme');
                  applyTheme(newTheme || 'light');
                }
              });
            });
            
            observer.observe(window.parent.document.documentElement, {
              attributes: true,
              attributeFilter: ['data-theme']
            });
          }
        } catch (e) {
          // Cross-origin, usar intervalo como fallback
          setInterval(function() {
            const savedTheme = localStorage.getItem('theme');
            const currentTheme = document.documentElement.getAttribute('data-theme');
            if (savedTheme && savedTheme !== currentTheme) {
              applyTheme(savedTheme);
            }
          }, 500);
        }
      }
      
      // Iniciar observador cuando el DOM esté listo
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', observeParentTheme);
      } else {
        observeParentTheme();
      }
    })();
  </script>
</head>
<body>
  <div class="container">
    
    <!-- Header -->
    <div class="header">
      <div>
        <h1 class="title">Gestión de Catering</h1>
        <p class="subtitle">Administra las reservas de catering de tus clientes</p>
      </div>
      <button class="btn-primary" id="btnNew">
        <i class="bi bi-plus-lg"></i>
        Agendar
      </button>
    </div>

    <!-- Stats + Filtros -->
    <div class="stats-filters-container">
      <!-- Stats Pills -->
      <div class="stats-pills">
        <button class="pill active" data-filter="agendado">
          <span class="pill-label">Agendados</span>
          <span class="pill-count">0</span>
        </button>
        <button class="pill" data-filter="en_curso">
          <span class="pill-label">En Curso</span>
          <span class="pill-count">0</span>
        </button>
        <button class="pill" data-filter="finalizado">
          <span class="pill-label">Finalizados</span>
          <span class="pill-count">0</span>
        </button>
        <button class="pill" data-filter="cancelado">
          <span class="pill-label">Cancelados</span>
          <span class="pill-count">0</span>
        </button>
        <button class="pill" data-filter="all">
          <span class="pill-label">Todos</span>
          <span class="pill-count">0</span>
        </button>
      </div>

      <!-- Búsqueda -->
      <div class="search-container">
        <i class="bi bi-search"></i>
        <input type="search" id="searchInput" class="search-input" placeholder="Buscar cliente, teléfono..." />
      </div>
    </div>

    <!-- Tabla -->
    <div class="card">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Cliente</th>
              <th>Contacto</th>
              <th>Fecha y Hora</th>
              <th>Servicio</th>
              <th class="text-center">Invitados</th>
              <th class="text-center">Estado</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="7" class="loading-cell">
                <div class="spinner"></div>
                <p>Cargando reservas...</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensaje vacío -->
      <div id="emptyMsg" class="empty-state" style="display: none;">
        <i class="bi bi-calendar-x"></i>
        <h3>No hay reservas</h3>
        <p>Las nuevas reservas aparecerán aquí</p>
      </div>
    </div>

  </div>

  <!-- Modal Drawer -->
  <div id="modalBackdrop" class="modal-backdrop"></div>
  <div id="modalDrawer" class="modal-drawer">
    <div class="drawer-header">
      <h2 id="drawerTitle">Nueva Reserva</h2>
      <button id="btnCloseModal" class="modal-close">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <form id="mainForm" class="drawer-form">
      <!-- Fila 1 -->
      <div class="form-row">
        <div class="form-group">
          <label for="f_nombre">Nombre del cliente *</label>
          <input id="f_nombre" type="text" class="form-input" placeholder="Nombre completo" required />
        </div>
        <div class="form-group">
          <label for="f_telefono">Teléfono *</label>
          <input id="f_telefono" type="tel" class="form-input" placeholder="0991 000 000" required />
        </div>
      </div>

      <!-- Fila 2 -->
      <div class="form-row">
        <div class="form-group">
          <label for="f_email">Email</label>
          <input id="f_email" type="email" class="form-input" placeholder="correo@ejemplo.com" />
        </div>
        <div class="form-group">
          <label for="f_direccion">Dirección del evento</label>
          <input id="f_direccion" type="text" class="form-input" placeholder="Calle, barrio..." />
        </div>
      </div>

      <!-- Fila 3 -->
      <div class="form-row">
        <div class="form-group">
          <label for="f_tipo">Tipo de Servicio</label>
          <input id="f_tipo" type="text" class="form-input" placeholder="Ej: Cumpleaños, Boda..." />
        </div>
        <div class="form-group">
          <label for="f_menu">Menú</label>
          <input id="f_menu" type="text" class="form-input" placeholder="Ej: Buffet, Ejecutivo..." />
        </div>
      </div>

      <!-- Fila 4 -->
      <div class="form-row">
        <div class="form-group">
          <label for="f_invitados">Cantidad de invitados *</label>
          <input id="f_invitados" type="number" class="form-input" min="1" placeholder="Ej: 25" required />
        </div>
        <div class="form-group">
          <label for="f_fecha">Fecha del evento *</label>
          <input id="f_fecha" type="date" class="form-input" required />
        </div>
      </div>

      <!-- Fila 5 -->
      <div class="form-row">
        <div class="form-group">
          <label for="f_hora">Hora *</label>
          <input id="f_hora" type="time" class="form-input" required />
        </div>
        <div class="form-group" id="statusCol" style="display: none;">
          <label for="f_estado">Estado</label>
          <select id="f_estado" class="form-input">
            <option value="agendado">Agendado</option>
            <option value="en_curso">En Curso</option>
            <option value="finalizado">Finalizado</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>
      </div>

      <!-- Botones -->
      <div class="form-actions">
        <button type="button" id="btnModalCancel" class="btn-secondary">
          Cancelar
        </button>
        <button type="submit" id="btnModalSave" class="btn-primary">
          <i class="bi bi-check-lg"></i>
          Agendar
        </button>
        <button type="button" id="btnModalDelete" class="btn-danger" style="display: none;">
          <i class="bi bi-trash"></i>
          Eliminar
        </button>
      </div>
    </form>
  </div>

  <!-- Toast Container -->
  <div id="toastArea" class="toast-area"></div>

  <!-- Scripts -->
  <script type="module" src="JS/catering.js"></script>
</body>
</html>